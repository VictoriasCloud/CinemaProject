# Сервис управления кинотеатром - Структура бд

## Таблицы

### Фильмы (movies):
- id (ПК)
- title - Название фильма.
- duration - Продолжительность фильма (в минутах инт).
- description - Описание фильма.

### Сеансы (session):
- id (ПК) - Уникальный идентификатор сеанса.
- movie_id (ВК) - Ссылка на фильм, который будет показан.
- room_id (ВК) - Ссылка на зал, где будет проходить сеанс.
- session_time - Время начала сеанса.
- session_end_time - Время окончания сеанса, рассчитывается как `session_time` + продолжительность фильма.

### Залы (room):
- id (ПК) - Уникальный идентификатор зала.
- room_name - Название или номер зала.
- seat_count - Количество мест в зале.

### Места (seat):
- id (ПК) - Уникальный идентификатор места.
- room_id (ВК) - Ссылка на зал, где находится место.
- session_id (ВК) - Ссылка на сеанс, к которому привязано место.
- seat_number - Номер места.
- seat_status - Статус места ("свободно", "занято").

### Билеты (ticket):
- id (ПК) - Уникальный идентификатор билета.
- session_id (ВК) - Ссылка на сеанс, на который куплен билет.
- seat_id (ВК) - Ссылка на место, которое забронировано или куплено.
- user_id (ВК) - Ссылка на пользователя, который купил билет.
- purchase_status - Статус покупки ("куплено", "возвращено").

### Пользователи (user):
- id (ПК) - Уникальный идентификатор пользователя.
- name - Имя пользователя.
- email - Электронная почта пользователя.

## Логика работы

1. Создание сеанса: При создании нового сеанса в таблицу `seat` автоматически добавляются записи для каждого места в зале с начальными статусами "свободно". Можно удалять через неделю записи допустим
2. Покупка билета: При покупке билета статус соответствующего места меняется на "занято", и в таблицу `ticket` добавляется запись о покупке.Можно удалять через неделю записи допустим
3. Возврат билета: При возврате билета статус места меняется обратно на "свободно", и покупка аннулируется.

## Преимущества структуры:

- Гибкость: Легко отслеживать состояние каждого места для конкретного сеанса, управлять покупками и возвратами.
- Избежание накладок: Поля `session_time` и `session_end_time` предотвращают пересечение сеансов в одном зале.
- Историчность: Таблица `ticket` хранит информацию о всех покупках и возвратах, что полезно для аналитики и будущих доработок (например, для анализа продаж или учёта возвратов).

Данная структура обеспечивает гибкость, расширяемость и поддерживает все необходимые функции для работы с билетами и сеансами.

# План доработок и улучшений

## Добавление логики обработки билетов

### Создание сервиса для работы с билетами:
- эндпоинты для покупки, бронирования и возврата билетов. Пользователь может указать свой номер билета и email для идентификации, после чего билет должен быть помечен в БД как возврат, а место в зале на этот билет должно отобразиться в списке свободных мест.
- [x] Необходимо описать структуру базы данных, чтобы понимать, как данные будут доставаться и обновляться.
- В базе данных хранить информацию о покупке билета на место и сеанс (куплено/не куплено) и проверять статус сеанса (время начала/окончания).

### Добавить функционал просмотра купленных билетов:
- Пользователи должны иметь возможность видеть свои купленные билеты.
- Реализовать простую проверку времени, чтобы предотвратить покупку билетов после начала сеанса.

## Реализация логики уведомлений

- В случае изменения времени сеанса или его отмены отправлять уведомления (например, через Kafka или email).

## Реализация управления системой кинотеатра (для администраторов)

- Админский интерфейс не требуется, но нужны эндпоинты для добавления фильмов и сеансов.
- Реализовать CRUD для фильмов и сеансов. В нашем кинотеатре предположим, что есть только один зал.
- Реализовать возможность изменять время сеансов и отменять их.

##  логика оплаты билетов

- Пока можно использовать заглушку для оплаты.

