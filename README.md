# CinemaProject

## Описание проекта

CinemaProject — это веб-приложение для управления покупки билетов в кинотеатр, 
сеансами фильмов и местами. Система интегрирована с Kafka и ZooKeeper для обработки 
сообщений, связанных с процессом бронирования и планирования сеансов.

### Реализовано Эндпоинты:

### **Фильмы (реализовано + пагинация)**
1. `POST http://localhost:8080/movies` — Добавление нового фильма.
2. `POST http://localhost:8080/movies/batch` — Добавление списка фильмов.
3. `PUT http://localhost:8080/movies?id=2` — Редактирование фильма.
4. `GET http://localhost:8080/movies?page=0&size=5` — Получение списка всех фильмов.
5. `GET http://localhost:8080/movies/2` — Получение информации о конкретном фильме.
6. `GET http://localhost:8080/movies?title=In&page=0&size=5` — Поиск фильмов по заголовку.
7. `DELETE http://localhost:8080/movies?id=1` — Удаление фильма по ID.
8. `DELETE http://localhost:8080/movies` — Удаление всех фильмов.


### **Комнаты (реализовано + пагинация)**
1. `POST http://localhost:8080/rooms` — Добавление новой комнаты.
2. `POST http://localhost:8080/rooms/batch` — Добавление списка комнат.
3. `GET http://localhost:8080/rooms?page=0&size=5` — Получение списка всех комнат.
4. `GET http://localhost:8080/rooms?id=1` — Получение информации о комнате по ID.
5. `GET http://localhost:8080/rooms?name=VIP&page=0&size=5` — Поиск комнаты по названию.
6. `GET http://localhost:8080/rooms?number=101` — Поиск комнаты по номеру.
7. `PUT http://localhost:8080/rooms?id=2` — Редактирование комнаты.
8. `DELETE http://localhost:8080/rooms?id=1` — Удаление комнаты по ID.
9. `DELETE http://localhost:8080/rooms` — Удаление всех комнат.

Логика такова, что при создании сеанса мы выбираем фильм(movie), зал(room), надбавку к базовой цене зала, 
начало сеанса (start_time). (конец сеанса(end_time) выставляем как длительность фильма
в таблице movie+начало сеанса). Во время создания сеанса также создаются записи в таблице seat(места). 
этих записей создаётся такое количество, какое указано таблице room как seat_count.
seat_number = это номера по порядку до seat_count(для каждого циклом устанавливаются).
на каждую такую запись seat задаются параметры seat_price равное room_price(из таблицы room)+надбавка.
Также при создании сеанса присутствует проверка на свободность зала(проверяется, 
что в данном зале ничего не проводится и не будет проводиться во время длительности сеанса).
можно изменять время начала и цену сеанса.  также решена задача когда задавать стоимость сеанса.

1) дефолтная цена на зал.
2) при созднии сеанса можем ввести надбавку к дефолтной цене.

### **Сеансы (реализовано)**
1. `POST http://localhost:8080/sessions` — Создание нового сеанса.
2. `GET http://localhost:8080/sessions` — Список всех сеансов.
3. `GET http://localhost:8080/sessions?id=2` — Получение информации о конкретном сеансе.
4. `GET http://localhost:8080/sessions/by-date?date=2024-10-13` — Список сеансов по дате.
5. `PUT http://localhost:8080/sessions?id=2` — Редактирование времени начала и/или цены сеанса.
6. `DELETE http://localhost:8080/sessions?id=1` — Удаление сеанса (удаляются связанные места).
7. `DELETE http://localhost:8080/sessions` — Удаление всех сеансов.


### **Билеты (реализовано)**
1. `POST http://localhost:8080/tickets` — Покупка билета (статус места меняется на "занято").
2. `GET http://localhost:8080/tickets?id=1` — Получение информации о конкретном билете.
3. `GET http://localhost:8080/tickets` — Получение списка всех билетов.
4. `GET http://localhost:8080/tickets/user?id=1` — Билеты пользователя по ID.
5. `GET http://localhost:8080/tickets/user/search?name=John` — Поиск билетов пользователя по имени.
6. `GET http://localhost:8080/tickets/status?status=BOOKED` — Получение билетов по статусу.
7. `GET http://localhost:8080/tickets/session?sessionId=3` — Билеты сеанса.
8. `PUT http://localhost:8080/tickets?id=1` — Возврат билета.
9. `DELETE http://localhost:8080/tickets?id=1` — Удаление билета по ID.
10. `DELETE http://localhost:8080/tickets` — Удаление всех билетов.


### **Места (реализовано)**
1. `POST http://localhost:8080/seats?id=3` — Создание места для сеанса.
2. `GET http://localhost:8080/seats` — Получение списка всех мест.
3. `GET http://localhost:8080/seats/session?id=3` — Список мест для конкретного сеанса.
4. `GET http://localhost:8080/seats?id=166` — Информация о конкретном месте.
5. `PUT http://localhost:8080/seats?id=166` — Редактирование информации о месте.
6. `DELETE http://localhost:8080/seats?id=166` — Удаление места (если оно не забронировано).
7. `DELETE http://localhost:8080/seats` — Удаление всех мест.


### **Пользователи (реализовано)**
1. `POST http://localhost:8080/users` — Создание пользователя.
2. `GET http://localhost:8080/users` — Получение списка всех пользователей.
3. `GET http://localhost:8080/users?id=3` — Информация о пользователе по ID.
4. `PUT http://localhost:8080/users?id=3` — Редактирование пользователя.
5. `DELETE http://localhost:8080/users?id=3` — Удаление пользователя по ID.
6. `DELETE http://localhost:8080/users` — Удаление всех пользователей.


### Реализована кафка:
Рекламные сообщения (топик theatre.infra.ads) — отправляются при создании 
или обновлении сеансов и содержат как текстовое сообщение 
("Привет, у нас появился в прокате новый фильм..."), так и JSON с подробной 
информацией о сеансе, включая название фильма, цену билета, номер зала, время начала и окончания сеанса.

Оповещения о начале сеанса (топик theatre.infra.bells) — запланированы на момент
начала сеанса с использованием SessionSchedulerService. В момент времени начала 
сеанса автоматически отправляется JSON-сообщение в Kafka с информацией о текущем сеансе.

- Java 9+
- Apache Kafka
- ZooKeeper
- Spring Boot
- Maven