# CinemaProject

## Описание проекта

CinemaProject — это веб-приложение для управления покупки билетов в кинотеатр, 
сеансами фильмов и местами. Система интегрирована с Kafka и ZooKeeper для обработки 
сообщений, связанных с процессом бронирования и планирования сеансов.

### Реализовано Эндпоинты:

**Фильмы(всё реализовано)+пагинация**:
1. `POST http://localhost:8080/movies` — Добавление нового фильма.
2. `POST http://localhost:8080/movies/batch` - добавление списка фильмов
3. `PUT http://localhost:8080/movies/?id=2`  - редактирование фильма
4. `GET {{base_url}}/movie?spage=0&size=5` — Получение списка всех фильмов.
5. `GET {{base_url}}/movies/{id}` — Получение информации о конкретном фильме.
6. `GET http://localhost:8080/movies/search?title=In&page=0&size=5 ` — Получение списка фильмов с данным совпадением в заголовке.
7. `DELETE http://localhost:8080/movies/?id=1` Удаление фильма по айди 
8. `DELETE http://localhost:8080/movies` - Удаление всех фильмов


**Комнаты(всё реализовано)+пагинация**
1. `POST http://localhost:8080/rooms` — Добавление новой комнаты
2. `POST http://localhost:8080/rooms/batch` - добавление списка комнат
3. `GET http://localhost:8080/?page=0&size=5` — Получение комнат для просмотра фильмов
4. `GET http://localhost:8080/rooms/?id=1`  — Получение информации о комнате по айди 
5. `GET http://localhost:8080/rooms/search/?name=VIP&page=0&size=5`  — Получение информации о комнате по совпадению названия
6. `GET http://localhost:8080/rooms/searchByNumber/?number=101`  — Получение информации о комнате по номера
7. `PUT http://localhost:8080/rooms/?id=2`  - редактирование комнаты
8. `DELETE http://localhost:8080/rooms/?id=1` Удаление комнаты по айди
9. `DELETE http://localhost:8080/rooms` - Удаление всех комнат


Логика такова, что при создании сеанса мы выбираем фильм(movie), зал(room), надбавку к базовой цене зала, 
начало сеанса (start_time). (конец сеанса(end_time) выставляем как длительность фильма
в таблице movie+начало сеанса). Во время создания сеанса также создаются записи в таблице seat(места). 
этих записей создаётся такое количество, какое указано таблице room как seat_count.
seat_number = это номера по порядку до seat_count(для каждого циклом устанавливаются).
на каждую такую запись seat задаются параметры seat_price равное room_price(из таблицы room)+надбавка.
Также при создании сеанса присутствует проверка на свободность зала(проверяется, 
что в данном зале ничего не проводится и не будет проводиться во время длительности сеанса).
можно изменять время начала и цену сеанса.  также решена задача когда задавать стоимость сеанса.

1) дефолтная цена на зал.
2) при созднии сеанса можем ввести надбавку к дефолтной цене.

**Сеансы(всё реализовано)**
1. `POST {{base_url}}/sessions` — Создание нового сеанса.
2. `GET {{base_url}}/sessions` — Список всех сеансов.
3. `GET {{base_url}}/sessions/?id=2` — Список всех сеансов.
4. `GET http://localhost:8080/sessions/by-date?date=2024-10-13` — Список всех сеансов по дате.
5. `PUT http://localhost:8080/sessions/?id=2` — Редактирование времени начала и/или цены сеанса.
6. `DELETE http://localhost:8080/sessions/?id=1` Удаление сеанса по айди, удаляются также созданные места на конкретный сеанс.
7. `DELETE http://localhost:8080/sessions` Удаление сеансов всех, удаляются также созданные места на сеансы.


**Билеты(всё реализовано)**
1. `POST ` — Покупка билета. При покупки статус места меняется на занято. 
2. `GET http://localhost:8080/tickets/?id=` — Получение информации о конкретном билете.
3. `GET http://localhost:8080/tickets` — Получение информации о всех билетах.
4. `GET http://localhost:8080/tickets/user/?id=` — Получение информации о билетах на конкретного человека по айди
5. `GET http://localhost:8080/tickets/user/search` — Получение информации о конкретном билете по имени пользователя
6. `GET http://localhost:8080/tickets/status/?status=` — Получение всех билетоа по конкретному статусу
7. `GET http://localhost:8080/tickets/session/?sessionId=` — Получение информации по айди сеанса
8. `PUT {{base_url}}/tickets/?id=` — Возврат билета.
9. `DELETE {{base_url}}/tickets/?id=1` — Удаление билета по айди
10. `DELETE {{base_url}}/tickets` — Удаление всех билетов


**Места(всё реализовано)**
1. `POST {{base_url}}/seats/?id=3` — Создание места на конкретную сессию
2. `GET http://localhost:8080/seats` — Получение информации о всех местах
3. `GET {{base_url}}/seats/session/?id=3` — Получение информации о всех местах сессии 3
4. `GET {{base_url}}/seats/?id=166` — Получение информации о конкретном месте
5. `PUT {{base_url}}/seats/?id=166` — Изменение информации о конкретном месте.
6. `DELETE {{base_url}}/seats/?id=166` — Удаление места(если оно не забронировано)
7. `DELETE {{base_url}}/seats` — Удаление всех мест

**Пользователи(всё реализовано)**
1. `POST {{base_url}}/users` — Создание юзера
2. `GET http://localhost:8080/users` — Получение информации юзерах
3. `GET {{base_url}}/users/?id=3` — Получение информации о юзере с айди 3
4. `PUT {{base_url}}/users/?id=3` — Изменение юзера
5. `DELETE {{base_url}}/users/?id=3` — Удаление юзера
6. `DELETE {{base_url}}/users` — Удаление всех юзеров

### Реализована кафка:
Рекламные сообщения (топик theatre.infra.ads) — отправляются при создании 
или обновлении сеансов и содержат как текстовое сообщение 
("Привет, у нас появился в прокате новый фильм..."), так и JSON с подробной 
информацией о сеансе, включая название фильма, цену билета, номер зала, время начала и окончания сеанса.

Оповещения о начале сеанса (топик theatre.infra.bells) — запланированы на момент
начала сеанса с использованием SessionSchedulerService. В момент времени начала 
сеанса автоматически отправляется JSON-сообщение в Kafka с информацией о текущем сеансе.

- Java 9+
- Apache Kafka
- ZooKeeper
- Spring Boot
- Maven
